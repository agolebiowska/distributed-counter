version: '3'
services:
  coordinator:
    container_name: coordinator
    build:
      context: coordinator
      dockerfile: ${DOCKERFILE}
    security_opt:
      - seccomp:unconfined
    ports:
      - ${HTTP_PORT}:8080
      - ${DEBUG_PORT}:40000
    restart: on-failure
    networks:
      - net
    volumes:
      - .:/go/src

  counter:
    container_name: counter
    build:
      context: counter
      dockerfile: ${DOCKERFILE}
    depends_on:
      - coordinator
    security_opt:
      - seccomp:unconfined
    ports:
      - ${COUNTER_HTTP_PORT}:8080
      - ${COUNTER_DEBUG_PORT}:40000
    restart: on-failure
    networks:
      - net
    volumes:
      - .:/go/src

networks:
  net:
    driver: bridge